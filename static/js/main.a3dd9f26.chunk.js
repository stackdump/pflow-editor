(this["webpackJsonppflow-editor"]=this["webpackJsonppflow-editor"]||[]).push([[0],{108:function(t,e,i){t.exports=i(176)},113:function(t,e,i){},128:function(t,e){},130:function(t,e){},155:function(t,e){},175:function(t,e,i){},176:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),r=i(25),s=i.n(r),o=(i(113),i(6)),l=i(4),c=i(9),u=i(10),h=i(3),p=i(11),d=i(102),f=i(99);function v(t){return{x:parseInt(t.x),y:parseInt(t.y)}}function g(t){return t.id[0]}function k(t){return parseInt(t.multiplicity[0])}var y=function t(e,i){Object(o.a)(this,t),this.schema=i.schema,this.places=i.places,this.transitions=i.transitions},b=function(){function t(e,i){Object(o.a)(this,t),this.schema=e,this.places={},this.transitions={},this._pnml=i,this._place_ids={},this._place_labels={},this._transition_ids={}}return Object(l.a)(t,[{key:"emptyVector",value:function(){for(var t=Object.keys(this.places).length,e=[],i=0;i<t;i++)e[i]=0;return e}},{key:"loadSubnets",value:function(t){if(t.subnet){var e=!0,i=!1,n=void 0;try{for(var a,r=t.subnet[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var s=a.value;this.loadSubnets(s)}}catch(U){i=!0,n=U}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}var o,l=!0,c=!1,u=void 0;try{for(var h,p=t.place.entries()[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var f=h.value,y=Object(d.a)(f,2),b=y[0],m=y[1];this._place_ids[g(m)]=b,this._place_labels[g(m)]=m.label,this.places[m.label]={offset:b,capacity:0,initial:(o=m,parseInt(o.tokens[0])),position:v(m)}}}catch(U){c=!0,u=U}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}var O=!0,j=!1,C=void 0;try{for(var x,E=t.transition[Symbol.iterator]();!(O=(x=E.next()).done);O=!0){var w=x.value;this._transition_ids[g(w)]=w.label,this.transitions[w.label]={role:"default",delta:this.emptyVector(),position:v(w),guards:{}}}}catch(U){j=!0,C=U}finally{try{O||null==E.return||E.return()}finally{if(j)throw C}}var S=!0,A=!1,F=void 0;try{for(var T,M=t.arc[Symbol.iterator]();!(S=(T=M.next()).done);S=!0){var P=T.value,_="",D="",N=null;this.isTransition(P.destinationId[0])?(D="destinationId",_="sourceId",N=-1*k(P)):(D="sourceId",_="destinationId",N=k(P));var V=this.transitions[this._transition_ids[P[D]]],L=this._place_ids[P[_]],R=this._place_labels[P[_]];if("inhibitor"===P.type[0]){var I=this.emptyVector();I[L]=N,V.guards[R]=I}else V.delta[L]=N}}catch(U){A=!0,F=U}finally{try{S||null==M.return||M.return()}finally{if(A)throw F}}}},{key:"isTransition",value:function(t){return t in this._transition_ids}},{key:"reindex",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this._pnml.document.subnet[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var r=n.value;this.loadSubnets(r)}}catch(b){e=!0,i=b}finally{try{t||null==a.return||a.return()}finally{if(e)throw i}}var s=!0,o=!1,l=void 0;try{for(var c,u=this._pnml.document.roles[0].role[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var h=c.value,p=h.name[0],d=!0,f=!1,v=void 0;try{for(var g,k=h.transitionId[Symbol.iterator]();!(d=(g=k.next()).done);d=!0){var y=g.value;this.transitions[this._transition_ids[y]].role=p}}catch(b){f=!0,v=b}finally{try{d||null==k.return||k.return()}finally{if(f)throw v}}}}catch(b){o=!0,l=b}finally{try{s||null==u.return||u.return()}finally{if(o)throw l}}}}]),t}(),m=["select","delete","var","place","transition","arc","token","execute"],O=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).menuAction=i.menuAction.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"menuAction",value:function(t){var e=this;this.props.ptnet.menuAction(t,(function(t){e.setState({mode:t})}))}},{key:"componentDidMount",value:function(){this.setState({mode:this.props.ptnet.getMode()})}},{key:"render",value:function(){var t=this;if(!this.state)return a.a.createElement(a.a.Fragment,null);var e=m.map((function(e){var i={color:"grey"};return t.state.mode===e&&(i={color:"black"}),a.a.createElement("button",{key:e,style:i,name:e,onClick:function(){return t.menuAction(e)},onContextMenu:function(t){return t.preventDefault()}},e)}));return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"menu",mode:this.props.ptnet.mode}," ",e," "),a.a.createElement("hr",null))}}]),e}(n.Component),j=i(177),C=i(200),x=i(196),E=i(197),w=i(194),S=Object(w.a)((function(t){return{root:{flexGrow:1},menuButton:{marginRight:t.spacing(2)},title:{flexGrow:1}}})),A=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).handleChange=i.handleChange.bind(Object(h.a)(i)),i.getData=i.getData.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){this.setState({tab:0})}},{key:"handleChange",value:function(t,e){this.setState({tab:e})}},{key:"getData",value:function(){var t=this.props.ptnet.getCurrentObj(),e={selected:t};if(!t)return{type:"Select"};if(e.type=this.props.ptnet.getType(t),!t)return this.props.ptnet.vars;switch(this.state.tab){case 0:e.source=this.props.ptnet.getObj(t.source),e.target=this.props.ptnet.getObj(t.target);break;case 1:e.vars=this.props.ptnet.vars}return e}},{key:"render",value:function(){if(!this.state)return a.a.createElement(a.a.Fragment,null);var t=S,e=this.getData();return a.a.createElement(j.a,{square:!0},a.a.createElement(C.a,{value:this.state.tab,indicatorColor:"primary",textColor:"primary",onChange:this.handleChange},a.a.createElement(x.a,{label:e.type||"Select"}),a.a.createElement(x.a,{label:"Variables"})),a.a.createElement("div",{style:{maxWidth:"100%"}},a.a.createElement(E.a,{variant:"h6",className:t.title},a.a.createElement("pre",null,JSON.stringify(e,null,"\t")))))}}]),e}(n.Component),F=i(198),T=i(199),M=i(101),P=i.n(M),_=Object(w.a)((function(t){return{root:{flexGrow:1},menuButton:{marginRight:t.spacing(2)},title:{flexGrow:1}}}));function D(){var t=_();return a.a.createElement("div",{className:t.root},a.a.createElement(F.a,{position:"static"},a.a.createElement(T.a,null,a.a.createElement(E.a,{variant:"h6",className:t.title},"Pflow-Editor"),a.a.createElement("a",{href:"https://github.com/stackdump/pflow-editor",target:"_blank",rel:"noopener noreferrer",className:t.dropdownLink}," ",a.a.createElement(P.a,null)," "))))}var N=function(t){function e(){var t,i;Object(o.a)(this,e);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(i=Object(c.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(a)))).dragging=function(t){i.state.dragging&&i.props.ptnet.positionUpdated(Object(h.a)(i),t),t.stopPropagation()},i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getHandleWidth",value:function(){return this.state.dragging?2*window.innerWidth:36}},{key:"getStroke",value:function(){return this.props.ptnet.isSelected(this.props.id)?"#8140ff":"#000000"}},{key:"componentDidMount",value:function(){this.setState({dragging:!1})}},{key:"startDrag",value:function(t){this.setState({dragging:!0}),t.stopPropagation()}},{key:"endDrag",value:function(t){this.setState({dragging:!1}),t.stopPropagation()}}]),e}(n.Component),V=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i.onAltClick=i.onAltClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"onClick",value:function(t){this.props.ptnet.placeClick(this.props.id),t.stopPropagation()}},{key:"onAltClick",value:function(t){this.props.ptnet.placeAltClick(this.props.id),t.preventDefault(),t.stopPropagation()}},{key:"render",value:function(){var t=this;if(!this.state)return a.a.createElement("g",null);var e=this.props.ptnet.getObj(this.props.id).position;return a.a.createElement("g",{onMouseDown:function(e){return t.startDrag(e)},onMouseUp:function(e){return t.endDrag(e)},onMouseMove:function(e){return t.dragging(e)},onClick:this.onClick,onContextMenu:this.onAltClick},a.a.createElement("circle",{id:this.props.id+"_handle",cx:e.x,cy:e.y,r:this.getHandleWidth(),fill:"transparent",stroke:"transparent"}),a.a.createElement("circle",{cx:e.x,cy:e.y,r:"20",id:this.props.id,strokeWidth:"1.5",fill:"#FFFFFF",stroke:this.getStroke(),orient:"0",className:"place",shapeRendering:"auto"}),function(){var i=t.props.ptnet.getTokenCount(t.props.id);if(0!==i)return 1===i?a.a.createElement("circle",{cx:e.x,cy:e.y,r:"2",id:t.props.id+"_tokens",fill:"#000000",stroke:"#000000",orient:"0",className:"tokens"}):i<10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-4,y:e.y+5,className:"large"},i):i>=10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-7,y:e.y+5,className:"small"},i):void 0}(),a.a.createElement("text",{id:this.props.id+"[label]",x:e.x-20,y:e.y-25,className:"small"},this.props.id))}}]),e}(N),L=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i.onAltClick=i.onAltClick.bind(Object(h.a)(i)),i.getMarker=i.getMarker.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getArcDef",value:function(){return{source:this.props.source,target:this.props.target}}},{key:"onClick",value:function(t){t.stopPropagation(),this.props.ptnet.arcClick(this.getArcDef())}},{key:"onAltClick",value:function(t){t.stopPropagation(),t.preventDefault(),this.props.ptnet.arcAltClick(this.getArcDef())}},{key:"getMarker",value:function(){return this.props.inhibitor?"url(#markerInhibit1)":"url(#markerArrow1)"}},{key:"render",value:function(){var t=this.props.ptnet.getObj(this.props.source),e=this.props.ptnet.getObj(this.props.target);if(!t||!e)return a.a.createElement("g",null);var i=t.position.x,n=t.position.y,r=e.position.x,s=e.position.y,o=(r+i)/2,l=(s+n)/2-8,c=4,u=4;Math.abs(r-o)<8&&(c=8),Math.abs(s-l)<8&&(u=0);var h=0;return h=this.props.inhibitor?"delta"in t?t.guards[this.props.target][e.offset]:e.guards[this.props.source][t.offset]:"delta"in t?t.delta[e.offset]:e.delta[t.offset],a.a.createElement("g",{onContextMenu:this.onAltClick},a.a.createElement("line",{stroke:"#000000",markerEnd:this.getMarker(),id:this.props.id,x1:i,y1:n,x2:r,y2:s}),a.a.createElement("text",{id:this.props.id+"[label]",x:o-c,y:l+u,className:"small"},Math.abs(h)),a.a.createElement("circle",{id:this.props.id+"[handle]",r:13,cx:o,cy:l,fill:"transparent",stroke:"transparent",onClick:this.onClick}))}}]),e}(n.Component),R=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getFill",value:function(){if(this.props.ptnet.isRunning()){if(this.props.ptnet.canFire(this.props.id))return"#62fa75";if(!this.props.ptnet.transitionFails(this.props.id))return"#fab5b0"}return"#ffffff"}},{key:"onClick",value:function(t){this.props.ptnet.transitionClick(this.props.id),t.stopPropagation()}},{key:"render",value:function(){var t=this,e=this.props.ptnet.getObj(this.props.id);return this.state&&e?a.a.createElement("g",{transform:"translate(-17,-17)",onClick:this.onClick,onMouseDown:function(e){return t.startDrag(e)},onMouseUp:function(e){return t.endDrag(e)},onMouseMove:function(e){return t.dragging(e)},onDoubleClick:function(t){return t.preventDefault()},onContextMenu:function(t){console.log("rightclick"),t.preventDefault(),t.stopPropagation()}},a.a.createElement("circle",{id:this.props.id+"_handle",cx:e.position.x+17,cy:e.position.y+17,r:this.getHandleWidth(),fill:"transparent",stroke:"transparent"}),a.a.createElement("rect",{className:"transition",width:"34",height:"34",fill:this.getFill(),stroke:this.getStroke(),id:this.props.id,x:e.position.x,y:e.position.y}),a.a.createElement("text",{id:this.props.id+"[label]",x:e.position.x,y:e.position.y-8,className:"small"},this.props.id)):a.a.createElement("g",null)}}]),e}(N),I=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i.onAltClick=i.onAltClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"onClick",value:function(t){this.props.ptnet.varClick(this.props.id),t.stopPropagation()}},{key:"onAltClick",value:function(t){this.props.ptnet.varAltClick(this.props.id),t.preventDefault(),t.stopPropagation()}},{key:"render",value:function(){var t=this;if(!this.state)return a.a.createElement("g",null);var e=this.props.ptnet.getObj(this.props.id).position;this.props.ptnet.getObj(this.props.id).position;return a.a.createElement("g",{onMouseDown:function(e){return t.startDrag(e)},onMouseUp:function(e){return t.endDrag(e)},onMouseMove:function(e){return t.dragging(e)},onClick:this.onClick,onContextMenu:this.onAltClick},a.a.createElement("circle",{id:this.props.id+"[handle]",cx:e.x,cy:e.y,r:this.getHandleWidth(),fill:"transparent",stroke:"transparent"}),a.a.createElement("circle",{cx:e.x,cy:e.y,r:"20",id:this.props.id,strokeWidth:"1.5",fill:"#FFFFFF",stroke:"#000000",orient:"0",className:"var",shapeRendering:"auto",strokeDasharray:"4"}),function(){var i=t.props.ptnet.vars[t.props.id].initial;if(0!==i)return 1===i?a.a.createElement("circle",{cx:e.x,cy:e.y,r:"2",id:t.props.id+"_tokens",fill:"#000000",stroke:"#000000",orient:"0",className:"tokens"}):i<10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-4,y:e.y+5,className:"large"},i):i>=10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-7,y:e.y+5,className:"small"},i):void 0}(),a.a.createElement("text",{id:this.props.id+"[label]",x:e.x-20,y:e.y-25,className:"small"},this.props.id),a.a.createElement("text",{id:this.props.id+"[label]",x:e.x+25,y:e.y+4,className:"note"},this.props.ptnet.vars[this.props.id].description))}}]),e}(N),U=function(t){function e(){return Object(o.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){var t=this,e=this.props.ptnet.places,i=this.props.ptnet.transitions,n=this.props.ptnet.vars,r=[];for(var s in e)r[e[s].offset]=s;var o=Object.keys(n).map((function(e,i){return a.a.createElement(I,{key:e,id:e,ptnet:t.props.ptnet})})),l=Object.keys(e).map((function(e,i){return a.a.createElement(V,{key:e,id:e,ptnet:t.props.ptnet})})),c=Object.keys(i).map((function(e,i){return a.a.createElement(R,{key:e,id:e,ptnet:t.props.ptnet})})),u=[];for(var h in i)for(var p in i[h].guards){var d=h+"-o"+p;u.push(a.a.createElement(L,{key:d,id:d,ptnet:this.props.ptnet,source:p,target:h,inhibitor:!0,transition:i}))}for(var f in i)for(var v in i[f].delta){var g=i[f].delta[v];if(g>0){var k=f+"->"+r[v];u.push(a.a.createElement(L,{key:k,id:k,ptnet:this.props.ptnet,source:f,target:r[v],transition:i}))}else if(g<0){var y=f+"<-"+r[v];u.push(a.a.createElement(L,{key:y,id:y,ptnet:this.props.ptnet,source:r[v],target:f,transition:i}))}}return a.a.createElement("g",{id:this.props.schema},o,u,l,c)}}]),e}(n.Component);var W=function(){function t(e,i){for(var n in Object(o.a)(this,t),this.state=[],this.capacity=[],this.transitions=i,this.places=e,e)this.capacity[e[n].offset]=e[n].capacity,this.state[e[n].offset]=e[n].initial;this.canFire=this.canFire.bind(this),this.guardsFail=this.guardsFail.bind(this),this.transitionFails=this.transitionFails.bind(this),this.fire=this.fire.bind(this)}return Object(l.a)(t,[{key:"vadd",value:function(t,e,i){var n=[],a=!0;for(var r in t)n[r]=t[r]+e[r]*i,(n[r]<0||this.capacity[r]>0&&this.capacity[r]>n[r])&&(a=!1);return[n,a]}},{key:"guardsFail",value:function(t,e){var i=this.transitions[t];for(var n in i.guards)if(this.vadd(this.state,i.guards[n],e)[1])return!0;return!1}},{key:"transitionFails",value:function(t,e){var i=this.transitions[t];return!this.vadd(this.state,i.delta,e||1)[1]}},{key:"canFire",value:function(t,e){if(null!=e&&e<0)return console.error("multiple must be positive value got: "+e),[this.state,!1];var i=this.transitions[t];return this.guardsFail(t,e||1)?[this.state,!1]:this.vadd(this.state,i.delta,e||1)}},{key:"fire",value:function(t,e,i){var n=this.canFire(t,e);n[1]&&(this.state=n[0],i&&i())}}]),t}();var Y=function(){function t(e,i,n){var a=this;Object(o.a)(this,t);var r=e();this.schema=r.schema,this.places=r.places,this.transitions=r.transitions,this.vars=r.vars||{},this.applyVars(),this.mode="select",this.update=function(){a.applyVars(),n()},this.save=i,this.simulation=null,this.lastSelected=null,this.currentSelection=null,this.getMode=this.getMode.bind(this),this.getObj=this.getObj.bind(this),this.getTokenCount=this.getTokenCount.bind(this),this.getCurrentObj=this.getCurrentObj.bind(this),this.getType=this.getType.bind(this),this.menuAction=this.menuAction.bind(this),this.positionUpdated=this.positionUpdated.bind(this),this.applyVars=this.applyVars.bind(this),this.isRunning=this.isRunning.bind(this),this.canFire=this.canFire.bind(this),this.guardsFail=this.guardsFail.bind(this),this.transitionFails=this.transitionFails.bind(this),this.fire=this.fire.bind(this),this.isSelected=this.isSelected.bind(this),this.editorClick=this.editorClick.bind(this),this.transitionClick=this.transitionClick.bind(this),this.placeClick=this.placeClick.bind(this),this.arcClick=this.arcClick.bind(this),this.arcAltClick=this.arcAltClick.bind(this),this.placeAltClick=this.placeAltClick.bind(this),this.varClick=this.varClick.bind(this),this.varAltClick=this.varAltClick.bind(this)}return Object(l.a)(t,[{key:"applyVars",value:function(){for(var t in this.vars){var e=this.vars[t];for(var i in e.mapping){var n=e.mapping[i];if("weight"in n){var a=this.getObj(n.weight.source),r=this.getObj(n.weight.target),s=-1;a&&"delta"in a&&(r=this.getObj(n.weight.source),a=this.getObj(n.weight.target),s=1),r&&a&&(r.delta[a.offset]=e.initial*s)}if("initial"in n){var o=this.getObj(n.initial.target);if(!o||o&&"delta"in o)return;o.initial=e.initial}}}}},{key:"getType",value:function(t){return t.target&&t.source?"Arc":t.target in this.transitions?"Transition":t.target in this.vars?"Variable":t.target in this.places?"Place":void 0}},{key:"getCurrentObj",value:function(){return this.currentSelection}},{key:"onObjSelect",value:function(t,e){this.currentSelection=t,e()}},{key:"placeSeq",value:function(){for(var t=0;this.places["place"+t];)t++;return"place"+t}},{key:"transitionSeq",value:function(){for(var t=0;this.transitions["txn"+t];)t++;return"txn"+t}},{key:"varSeq",value:function(){for(var t=0;this.vars["var"+t];)t++;return"var"+t}},{key:"isRunning",value:function(){return"execute"===this.mode&&null!=this.simulation}},{key:"getTokenCount",value:function(t){var e=this.getObj(t);return e?this.isRunning()?this.simulation.state[e.offset]:e.initial:(console.error("place not found "+t),-1)}},{key:"fire",value:function(t,e){var i=!1;return this.isRunning()&&this.simulation.fire(t,e||1,(function(){i=!0})),i}},{key:"canFire",value:function(t,e){var i=this.getObj(t);return(!e||i.role===e)&&(!!(this.isRunning()&&t in this.transitions)&&this.simulation.canFire(t)[1])}},{key:"guardsFail",value:function(t,e){return this.simulation.guardsFail(t,e)}},{key:"transitionFails",value:function(t,e){return this.simulation.transitionFails(t,e)}},{key:"getMode",value:function(){return this.mode}},{key:"getObj",value:function(t){return t in this.transitions?this.transitions[t]:t in this.places?this.places[t]:this.vars[t]}},{key:"positionUpdated",value:function(t,e,i){if(!(["execute","delete"].indexOf(this.mode)>=0)){var n=this.getObj(t.props.id);n.position.x=n.position.x+e.movementX,n.position.y=n.position.y+e.movementY,this.update(),i&&i()}}},{key:"menuAction",value:function(t,e){switch(this.mode===t&&(t="select"),this.mode=t,t){case"execute":this.simulation=new W((i=this).places,i.transitions)}var i;this.update(),e&&e(this.mode)}},{key:"emptyVector",value:function(){return Object.keys(this.places).map((function(){return 0}))}},{key:"addPlace",value:function(t){var e=Object.keys(this.places).length;for(var i in this.places[this.placeSeq()]={initial:0,capacity:0,offset:e,position:{x:t.x,y:t.y-60}},this.transitions)this.transitions[i].delta[e]=0;return!0}},{key:"addTransition",value:function(t){var e=this.transitionSeq();return this.transitions[e]={role:"default",delta:this.emptyVector(),position:{x:t.x,y:t.y-60},guards:{}},!0}},{key:"editorClick",value:function(t){var e=!1;switch(this.mode){case"place":e=this.addPlace({x:t.clientX-8,y:t.clientY-25});break;case"transition":e=this.addTransition({x:t.clientX-8,y:t.clientY-25});break;case"var":e=this.addVar({x:t.clientX-8,y:t.clientY-25})}t.stopPropagation(),e&&this.update()}},{key:"validArc",value:function(t,e){return t in this.places&&e in this.transitions||t in this.transitions&&e in this.places}},{key:"addArc",value:function(t,e){var i=null,n=null,a=0;t in this.transitions?(a=1,i=this.transitions[t],n=this.places[e]):(a=-1,i=this.transitions[e],n=this.places[t]),i.delta[n.offset]=a}},{key:"pairSelected",value:function(t,e){var i=!1;switch(this.mode){case"arc":this.validArc(t,e)&&(this.addArc(t,e),i=!0)}return this.lastSelected=null,i}},{key:"selectObj",value:function(t){this.lastSelected?this.pairSelected(this.lastSelected,t):this.lastSelected=t}},{key:"delPlace",value:function(t){var e=this.places[t].offset;for(var i in this.transitions)delete this.transitions[i].delta[e],delete this.transitions[i].guards[t];delete this.places[t]}},{key:"delArc",value:function(t){var e=null,i=null;t.source in this.places?(e=t.source,i=t.target):(i=t.source,e=t.target);var n=this.places[e].offset;this.transitions[i].delta[n]=0,delete this.transitions[i].guards[e]}},{key:"placeAltClick",value:function(t){var e=!1;switch(this.mode){case"token":var i=this.getObj(t);i.initial>0&&(i.initial--,e=!0)}e&&this.update()}},{key:"placeClick",value:function(t){var e=this;this.onObjSelect({target:t},(function(){switch(e.mode){case"delete":e.delPlace(t);break;case"arc":e.selectObj(t);break;case"token":e.getObj(t).initial++}e.update()}))}},{key:"transitionClick",value:function(t){var e=this;this.onObjSelect({target:t},(function(){switch(e.mode){case"execute":e.fire(t);break;case"delete":delete e.transitions[t],e.currentSelection=null;break;case"arc":e.selectObj(t)}e.update()}))}},{key:"isSelected",value:function(t){return this.lastSelected===t}},{key:"toggleInhibitor",value:function(t){if(t.source in this.transitions)return!1;var e=t.source,i=this.getObj(t.source),n=this.getObj(t.target);return 0!==n.delta[i.offset]?(n.guards[e]=this.emptyVector(),n.guards[e][i.offset]=n.delta[i.offset],n.delta[i.offset]=0):(n.delta[i.offset]=n.guards[e][i.offset],delete n.guards[e]),!0}},{key:"addGuardToken",value:function(t,e,i,n){var a=t.guards[e][i];return a>0&&(a+=n),a<0&&(a-=n),0!==a&&(t.guards[e][i]=a,!0)}},{key:"addArcToken",value:function(t,e){var i=null,n=null,a=null;if(t.source in this.transitions?(i=this.getObj(t.source),n=this.getObj(t.target),a=t.target):(i=this.getObj(t.target),n=this.getObj(t.source),a=t.source),0===i.delta[n.offset])return this.addGuardToken(i,a,n.offset,e);var r=i.delta[n.offset];return r>0&&(r+=e),r<0&&(r-=e),0!==r&&(i.delta[n.offset]=r,!0)}},{key:"arcClick",value:function(t){var e=this;this.onObjSelect(t,(function(){switch(e.mode){case"token":e.addArcToken(t,1);break;case"delete":t.source,e.transitions,e.delArc(t)}e.update()}))}},{key:"arcAltClick",value:function(t){var e=!1;switch(this.mode){case"arc":e=this.toggleInhibitor(t);break;case"token":e=this.addArcToken(t,-1)}e&&this.update()}},{key:"addVar",value:function(t){var e=Object.keys(this.vars).length;return this.vars[this.varSeq()]={initial:0,offset:e,position:{x:t.x,y:t.y-60}},!0}},{key:"addVarToken",value:function(t,e){return this.vars[t].initial+=e||1,!0}},{key:"varClick",value:function(t){var e=this;this.onObjSelect({target:t},(function(){switch(e.mode){case"token":e.addVarToken(t,1)}e.update()}))}},{key:"varAltClick",value:function(t){var e=this;this.onObjSelect({target:t},(function(){switch(e.mode){case"token":e.addVarToken(t,-1)}e.update()}))}}]),t}(),q=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"onClick",value:function(t){this.state.editorClick(t)}},{key:"componentDidMount",value:function(){var t,e=this;this.setState((t={onLoad:function(){var t=e.props.getPflow();return t.vars={":COLLATERAL:":{initial:5,offset:0,position:{x:640,y:100},description:"Amount USD on deposit",mapping:[{weight:{source:"INPUT",target:"COLLATERAL"}},{weight:{source:"COLLATERAL",target:"COVER"}},{initial:{target:"COLLATERAL"}}]},":TOKENS:":{initial:7,offset:1,position:{x:640,y:180},description:"Y: Number of tokens being shorted",mapping:[{weight:{source:"INPUT",target:"TOKENS"}},{weight:{source:"TOKENS",target:"COVER"}},{initial:{target:"TOKENS"}}]},":VALUE:":{initial:8,offset:2,position:{x:640,y:260},description:" Current Value = 2 * Collateral - Y * (rate of pXYZ in block M = 2/7)",mapping:[{weight:{source:"COVER",target:"OUTPUT"}}]}},t},onSave:this.props.setPflow,onUpdate:function(){e.setState(e.state)}},new Y(t.onLoad,t.onSave,t.onUpdate)))}},{key:"render",value:function(){return this.state?a.a.createElement(a.a.Fragment,null,a.a.createElement(D,{ptnet:this.state}),a.a.createElement(O,{ptnet:this.state}),a.a.createElement("svg",{width:window.innerWidth,height:500,onContextMenu:function(t){return t.preventDefault()},onClick:this.onClick},a.a.createElement("defs",null,a.a.createElement("marker",{id:"markerArrow1",markerWidth:"23",markerHeight:"13",refX:"31",refY:"6",orient:"auto"},a.a.createElement("rect",{className:"transition",width:"28",height:"3",fill:"#ffffff",stroke:"#ffffff",x:"3",y:"5"}),a.a.createElement("path",{d:"M2,2 L2,11 L10,6 L2,2"})),a.a.createElement("marker",{id:"markerInhibit1",markerWidth:"23",markerHeight:"13",refX:"31",refY:"6",orient:"auto"},a.a.createElement("rect",{className:"transition",width:"28",height:"3",fill:"#ffffff",stroke:"#ffffff",x:"3",y:"5"}),a.a.createElement("circle",{cx:"5",cy:"6.5",r:4}))),a.a.createElement(U,{ptnet:this.state})),a.a.createElement("hr",null),a.a.createElement(A,{ptnet:this.state})):a.a.createElement(a.a.Fragment,null)}}]),e}(n.Component),X=(i(175),function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).getPflow=i.getPflow.bind(Object(h.a)(i)),i.setPflow=i.setPflow.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getPflow",value:function(){return JSON.parse(JSON.stringify(this.state.ptnet))}},{key:"setPflow",value:function(t){this.setState({ptnet:t})}},{key:"open",value:function(t){var e=this;!function(t,e,i){var n=new XMLHttpRequest;n.open("GET","schemata/"+t+".pflow",!0),n.onload=function(a){4===n.readyState&&(200===n.status?Object(f.parseString)(n.responseText,(function(i,n){if(i)console.error(i);else{var a=new b(t,n);a.reindex(),e(new y(t,a))}})):(i(n.statusText),console.error(n.statusText)))},n.onerror=function(t){return console.error(n.statusText),null},n.send(null)}(t,(function(t){e.setPflow(t)}))}},{key:"componentDidMount",value:function(){this.open("pshort")}},{key:"render",value:function(){return this.state?a.a.createElement(q,{getPflow:this.getPflow,setPflow:this.setPflow}):a.a.createElement(a.a.Fragment,null)}}]),e}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[108,1,2]]]);
//# sourceMappingURL=main.a3dd9f26.chunk.js.map