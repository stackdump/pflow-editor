(this["webpackJsonppflow-editor"]=this["webpackJsonppflow-editor"]||[]).push([[0],{102:function(t,e){},104:function(t,e){},129:function(t,e){},144:function(t,e,i){},145:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),s=i(79),r=i.n(s),o=(i(87),i(1)),l=i(2),c=i(7),u=i(5),h=i(4),p=i(6),d=i(81),f=i(80);function v(t){return{x:parseInt(t.x),y:parseInt(t.y)}}function k(t){return t.id[0]}function y(t){return parseInt(t.multiplicity[0])}var g=function t(e,i){Object(o.a)(this,t),this.schema=i.schema,this.places=i.places,this.transitions=i.transitions},m=function(){function t(e,i){Object(o.a)(this,t),this.schema=e,this.places={},this.transitions={},this._pnml=i,this._place_ids={},this._place_labels={},this._transition_ids={}}return Object(l.a)(t,[{key:"emptyVector",value:function(){for(var t=Object.keys(this.places).length,e=[],i=0;i<t;i++)e[i]=0;return e}},{key:"loadSubnets",value:function(t){if(t.subnet){var e=!0,i=!1,n=void 0;try{for(var a,s=t.subnet[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var r=a.value;this.loadSubnets(r)}}catch(H){i=!0,n=H}finally{try{e||null==s.return||s.return()}finally{if(i)throw n}}}var o,l=!0,c=!1,u=void 0;try{for(var h,p=t.place.entries()[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var f=h.value,g=Object(d.a)(f,2),m=g[0],b=g[1];this._place_ids[k(b)]=m,this._place_labels[k(b)]=b.label,this.places[b.label]={offset:m,capacity:0,initial:(o=b,parseInt(o.tokens[0])),position:v(b)}}}catch(H){c=!0,u=H}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}var O=!0,j=!1,C=void 0;try{for(var x,w=t.transition[Symbol.iterator]();!(O=(x=w.next()).done);O=!0){var E=x.value;this._transition_ids[k(E)]=E.label,this.transitions[E.label]={role:"default",delta:this.emptyVector(),position:v(E),guards:{}}}}catch(H){j=!0,C=H}finally{try{O||null==w.return||w.return()}finally{if(j)throw C}}var S=!0,A=!1,M=void 0;try{for(var _,P=t.arc[Symbol.iterator]();!(S=(_=P.next()).done);S=!0){var F=_.value,D="",T="",I=null;this.isTransition(F.destinationId[0])?(T="destinationId",D="sourceId",I=-1*y(F)):(T="sourceId",D="destinationId",I=y(F));var N=this.transitions[this._transition_ids[F[T]]],W=this._place_ids[F[D]],R=this._place_labels[F[D]];if("inhibitor"===F.type[0]){var U=this.emptyVector();U[W]=I,N.guards[R]=U}else N.delta[W]=I}}catch(H){A=!0,M=H}finally{try{S||null==P.return||P.return()}finally{if(A)throw M}}}},{key:"isTransition",value:function(t){return t in this._transition_ids}},{key:"reindex",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this._pnml.document.subnet[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var s=n.value;this.loadSubnets(s)}}catch(m){e=!0,i=m}finally{try{t||null==a.return||a.return()}finally{if(e)throw i}}var r=!0,o=!1,l=void 0;try{for(var c,u=this._pnml.document.roles[0].role[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var h=c.value,p=h.name[0],d=!0,f=!1,v=void 0;try{for(var k,y=h.transitionId[Symbol.iterator]();!(d=(k=y.next()).done);d=!0){var g=k.value;this.transitions[this._transition_ids[g]].role=p}}catch(m){f=!0,v=m}finally{try{d||null==y.return||y.return()}finally{if(f)throw v}}}}catch(m){o=!0,l=m}finally{try{r||null==u.return||u.return()}finally{if(o)throw l}}}}]),t}(),b=function(t){function e(){var t,i;Object(o.a)(this,e);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(i=Object(c.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(a)))).dragging=function(t){i.state.dragging&&i.props.ptnet.positionUpdated(Object(h.a)(i),t),t.stopPropagation()},i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getHandleWidth",value:function(){return this.state.dragging?2*window.innerWidth:36}},{key:"getStroke",value:function(){return this.props.ptnet.isSelected(this.props.id)?"#8140ff":"#000000"}},{key:"componentDidMount",value:function(){this.setState({dragging:!1})}},{key:"startDrag",value:function(t){this.setState({dragging:!0}),t.stopPropagation()}},{key:"endDrag",value:function(t){this.setState({dragging:!1}),t.stopPropagation()}}]),e}(n.Component),O=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i.onAltClick=i.onAltClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"onClick",value:function(t){this.props.ptnet.placeClick(this.props.id),t.stopPropagation()}},{key:"onAltClick",value:function(t){this.props.ptnet.placeAltClick(this.props.id),t.preventDefault(),t.stopPropagation()}},{key:"render",value:function(){var t=this;if(!this.state)return a.a.createElement("g",null);var e=this.props.ptnet.getObj(this.props.id).position;return a.a.createElement("g",{onMouseDown:function(e){return t.startDrag(e)},onMouseUp:function(e){return t.endDrag(e)},onMouseMove:function(e){return t.dragging(e)},onClick:this.onClick,onContextMenu:this.onAltClick},a.a.createElement("circle",{id:this.props.id+"_handle",cx:e.x,cy:e.y,r:this.getHandleWidth(),fill:"transparent",stroke:"transparent"}),a.a.createElement("circle",{cx:e.x,cy:e.y,r:"20",id:this.props.id,strokeWidth:"1.5",fill:"#FFFFFF",stroke:this.getStroke(),orient:"0",className:"place",shapeRendering:"auto"}),function(){var i=t.props.ptnet.getTokenCount(t.props.id);if(0!==i)return 1===i?a.a.createElement("circle",{cx:e.x,cy:e.y,r:"2",id:t.props.id+"_tokens",fill:"#000000",stroke:"#000000",orient:"0",className:"tokens"}):i<10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-4,y:e.y+5,className:"large"},i):i>=10?a.a.createElement("text",{id:t.props.id+"_tokens",x:e.x-7,y:e.y+5,className:"small"},i):void 0}(),a.a.createElement("text",{id:this.props.id+"[label]",x:e.x-20,y:e.y-25,className:"small"},this.props.id))}}]),e}(b),j=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i.onAltClick=i.onAltClick.bind(Object(h.a)(i)),i.getMarker=i.getMarker.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getArcDef",value:function(){return{source:this.props.source,target:this.props.target}}},{key:"onClick",value:function(t){t.stopPropagation(),this.props.ptnet.arcClick(this.getArcDef())}},{key:"onAltClick",value:function(t){t.stopPropagation(),t.preventDefault(),this.props.ptnet.arcAltClick(this.getArcDef())}},{key:"getMarker",value:function(){return this.props.inhibitor?"url(#markerInhibit1)":"url(#markerArrow1)"}},{key:"render",value:function(){var t=this.props.ptnet.getObj(this.props.source),e=this.props.ptnet.getObj(this.props.target);if(!t||!e)return a.a.createElement("g",null);var i=t.position.x,n=t.position.y,s=e.position.x,r=e.position.y,o=(s+i)/2,l=(r+n)/2-8,c=4,u=4;Math.abs(s-o)<8&&(c=8),Math.abs(r-l)<8&&(u=0);var h=0;return h=this.props.inhibitor?"delta"in t?t.guards[this.props.target][e.offset]:e.guards[this.props.source][t.offset]:"delta"in t?t.delta[e.offset]:e.delta[t.offset],a.a.createElement("g",{onContextMenu:this.onAltClick},a.a.createElement("line",{stroke:"#000000",markerEnd:this.getMarker(),id:this.props.id,x1:i,y1:n,x2:s,y2:r}),a.a.createElement("text",{id:this.props.id+"[label]",x:o-c,y:l+u,className:"small"},Math.abs(h)),a.a.createElement("circle",{id:this.props.id+"[handle]",r:13,cx:o,cy:l,fill:"transparent",stroke:"transparent",onClick:this.onClick}))}}]),e}(n.Component),C=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getFill",value:function(){return this.props.ptnet.canFire(this.props.id)?"#facade":"#ffffff"}},{key:"onClick",value:function(t){this.props.ptnet.transitionClick(this.props.id),t.stopPropagation()}},{key:"render",value:function(){var t=this,e=this.props.ptnet.getObj(this.props.id);return this.state&&e?a.a.createElement("g",{transform:"translate(-17,-17)",onClick:this.onClick,onMouseDown:function(e){return t.startDrag(e)},onMouseUp:function(e){return t.endDrag(e)},onMouseMove:function(e){return t.dragging(e)},onDoubleClick:function(t){return t.preventDefault()},onContextMenu:function(t){console.log("rightclick"),t.preventDefault(),t.stopPropagation()}},a.a.createElement("circle",{id:this.props.id+"_handle",cx:e.position.x+17,cy:e.position.y+17,r:this.getHandleWidth(),fill:"transparent",stroke:"transparent"}),a.a.createElement("rect",{className:"transition",width:"34",height:"34",fill:this.getFill(),stroke:this.getStroke(),id:this.props.id,x:e.position.x,y:e.position.y}),a.a.createElement("text",{id:this.props.id+"[label]",x:e.position.x,y:e.position.y-8,className:"small"},this.props.id)):a.a.createElement("g",null)}}]),e}(b),x=function(t){function e(){return Object(o.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){var t=this,e=this.props.ptnet.places,i=this.props.ptnet.transitions,n=[];for(var s in e)n[e[s].offset]=s;var r=Object.keys(e).map((function(e,i){return a.a.createElement(O,{key:e,id:e,ptnet:t.props.ptnet})})),o=Object.keys(i).map((function(e,i){return a.a.createElement(C,{key:e,id:e,ptnet:t.props.ptnet})})),l=[];for(var c in i)for(var u in i[c].guards){var h=c+"-o"+u;l.push(a.a.createElement(j,{key:h,id:h,ptnet:this.props.ptnet,source:u,target:c,inhibitor:!0,transition:i}))}for(var p in i)for(var d in i[p].delta){var f=i[p].delta[d];if(f>0){var v=p+"->"+n[d];l.push(a.a.createElement(j,{key:v,id:v,ptnet:this.props.ptnet,source:p,target:n[d],transition:i}))}else if(f<0){var k=p+"<-"+n[d];l.push(a.a.createElement(j,{key:k,id:k,ptnet:this.props.ptnet,source:n[d],target:p,transition:i}))}}return a.a.createElement("g",{id:this.props.schema},l,r,o)}}]),e}(n.Component),w=["select","delete","place","transition","arc","token","execute"],E=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).menuAction=i.menuAction.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"menuAction",value:function(t){var e=this;this.props.ptnet.menuAction(t,(function(t){e.setState({mode:t})}))}},{key:"componentDidMount",value:function(){this.setState({mode:this.props.ptnet.getMode()})}},{key:"render",value:function(){var t=this;if(!this.state)return a.a.createElement(a.a.Fragment,null);var e=w.map((function(e){var i={color:"grey"};return t.state.mode===e&&(i={color:"black"}),a.a.createElement("button",{key:e,style:i,name:e,onClick:function(){return t.menuAction(e)},onContextMenu:function(t){return t.preventDefault()}},e)}));return a.a.createElement("div",{className:"menu",mode:this.props.ptnet.mode}," ",e," ")}}]),e}(n.Component);var S=function(){function t(e,i){for(var n in Object(o.a)(this,t),this.state=[],this.capacity=[],this.transitions=i,this.history=[],e)this.capacity[e[n].offset]=e[n].capacity,this.state[e[n].offset]=e[n].initial;this.canFire=this.canFire.bind(this),this.fire=this.fire.bind(this)}return Object(l.a)(t,[{key:"vadd",value:function(t,e,i){var n=[],a=!0;for(var s in t)n[s]=t[s]+e[s]*i,(n[s]<0||this.capacity[s]>0&&this.capacity[s]>n[s])&&(a=!1);return[n,a]}},{key:"guardsFail",value:function(t,e){var i=this.transitions[t];for(var n in i.guards)if(this.vadd(this.state,i.guards[n],e)[1])return!0;return!1}},{key:"canFire",value:function(t,e){if(null!=e&&e<0)return console.error("multiple must be positive value got: "+e),[this.state,!1];var i=this.transitions[t];return this.guardsFail(t,e||1)?[this.state,!1]:this.vadd(this.state,i.delta,e||1)}},{key:"fire",value:function(t,e,i){var n=this.canFire(t,e);n[1]&&(this.state=n[0],i&&i())}}]),t}();var A=function(){function t(e,i,n){Object(o.a)(this,t);var a=e();this.schema=a.schema,this.places=a.places,this.transitions=a.transitions,this.mode="select",this.update=n,this.save=i,this.simulation=null,this.lastSelected=null,this.getMode=this.getMode.bind(this),this.getObj=this.getObj.bind(this),this.getTokenCount=this.getTokenCount.bind(this),this.menuAction=this.menuAction.bind(this),this.positionUpdated=this.positionUpdated.bind(this),this.isRunning=this.isRunning.bind(this),this.canFire=this.canFire.bind(this),this.fire=this.fire.bind(this),this.isSelected=this.isSelected.bind(this),this.editorClick=this.editorClick.bind(this),this.transitionClick=this.transitionClick.bind(this),this.placeClick=this.placeClick.bind(this),this.arcClick=this.arcClick.bind(this),this.arcAltClick=this.arcAltClick.bind(this),this.placeAltClick=this.placeAltClick.bind(this)}return Object(l.a)(t,[{key:"placeSeq",value:function(){for(var t=0;this.places["place"+t];)t++;return"place"+t}},{key:"transitionSeq",value:function(){for(var t=0;this.transitions["txn"+t];)t++;return"txn"+t}},{key:"isRunning",value:function(){return"execute"===this.mode&&null!=this.simulation}},{key:"getTokenCount",value:function(t){var e=this.getObj(t);return e?this.isRunning()?this.simulation.state[e.offset]:e.initial:(console.error("place not found "+t),-1)}},{key:"fire",value:function(t,e){var i=!1;return this.isRunning()&&this.simulation.fire(t,e||1,(function(){i=!0})),i}},{key:"canFire",value:function(t,e){var i=this.getObj(t);return(!e||i.role===e)&&(!!(this.isRunning()&&t in this.transitions)&&this.simulation.canFire(t)[1])}},{key:"getMode",value:function(){return this.mode}},{key:"getObj",value:function(t){return t in this.transitions?this.transitions[t]:this.places[t]}},{key:"positionUpdated",value:function(t,e,i){if(!(["execute","delete"].indexOf(this.mode)>=0)){var n=this.getObj(t.props.id);n.position.x=n.position.x+e.movementX,n.position.y=n.position.y+e.movementY,this.update(),i&&i()}}},{key:"menuAction",value:function(t,e){switch(this.mode===t&&(t="select"),this.mode=t,t){case"execute":this.simulation=new S((i=this).places,i.transitions)}var i;this.update(),e&&e(this.mode)}},{key:"emptyVector",value:function(){return Object.keys(this.places).map((function(){return 0}))}},{key:"addPlace",value:function(t){var e=Object.keys(this.places).length;for(var i in this.places[this.placeSeq()]={initial:0,capacity:0,offset:e,position:t},this.transitions)this.transitions[i].delta[e]=0;return!0}},{key:"addTransition",value:function(t){var e=this.transitionSeq();return this.transitions[e]={role:"default",delta:this.emptyVector(),position:t,guards:{}},!0}},{key:"editorClick",value:function(t){var e=!1;switch(this.mode){case"place":e=this.addPlace({x:t.clientX-8,y:t.clientY-25});break;case"transition":e=this.addTransition({x:t.clientX-8,y:t.clientY-25})}t.stopPropagation(),e&&this.update()}},{key:"validArc",value:function(t,e){return t in this.places&&e in this.transitions||t in this.transitions&&e in this.places}},{key:"addArc",value:function(t,e){var i=null,n=null,a=0;t in this.transitions?(a=1,i=this.transitions[t],n=this.places[e]):(a=-1,i=this.transitions[e],n=this.places[t]),i.delta[n.offset]=a}},{key:"pairSelected",value:function(t,e){var i=!1;switch(this.mode){case"arc":this.validArc(t,e)&&(this.addArc(t,e),i=!0)}return this.lastSelected=null,i}},{key:"selectObj",value:function(t){this.lastSelected?this.pairSelected(this.lastSelected,t):this.lastSelected=t}},{key:"delPlace",value:function(t){var e=this.places[t].offset;for(var i in this.transitions)delete this.transitions[i].delta[e],delete this.transitions[i].guards[t];delete this.places[t]}},{key:"delArc",value:function(t){var e=null,i=null;t.source in this.places?(e=t.source,i=t.target):(i=t.source,e=t.target);var n=this.places[e].offset;this.transitions[i].delta[n]=0,delete this.transitions[i].guards[e]}},{key:"placeAltClick",value:function(t){var e=!1;switch(this.mode){case"token":var i=this.getObj(t);i.initial>0&&(i.initial--,e=!0)}e&&this.update()}},{key:"placeClick",value:function(t){var e=!1;switch(this.mode){case"delete":this.delPlace(t),e=!0;break;case"arc":this.selectObj(t),e=!0;break;case"token":this.getObj(t).initial++,e=!0}e&&this.update()}},{key:"transitionClick",value:function(t){var e=!1;switch(this.mode){case"execute":e=this.fire(t);break;case"delete":delete this.transitions[t],e=!0;break;case"arc":this.selectObj(t),e=!0}e&&this.update()}},{key:"isSelected",value:function(t){return this.lastSelected===t}},{key:"toggleInhibitor",value:function(t){if(t.source in this.transitions)return!1;var e=t.source,i=this.getObj(t.source),n=this.getObj(t.target);return 0!==n.delta[i.offset]?(n.guards[e]=this.emptyVector(),n.guards[e][i.offset]=n.delta[i.offset],n.delta[i.offset]=0):(n.delta[i.offset]=n.guards[e][i.offset],delete n.guards[e]),!0}},{key:"addGuardToken",value:function(t,e,i,n){var a=t.guards[e][i];return a>0&&(a+=n),a<0&&(a-=n),0!==a&&(t.guards[e][i]=a,!0)}},{key:"addArcToken",value:function(t,e){var i=null,n=null,a=null;if(t.source in this.transitions?(i=this.getObj(t.source),n=this.getObj(t.target),a=t.target):(i=this.getObj(t.target),n=this.getObj(t.source),a=t.source),0===i.delta[n.offset])return this.addGuardToken(i,a,n.offset,e);var s=i.delta[n.offset];return s>0&&(s+=e),s<0&&(s-=e),0!==s&&(i.delta[n.offset]=s,!0)}},{key:"arcClick",value:function(t){var e=!1;switch(this.mode){case"token":console.log("token++"),e=this.addArcToken(t,1);break;case"delete":t.source,this.transitions,this.delArc(t),e=!0}e&&this.update()}},{key:"arcAltClick",value:function(t){var e=!1;switch(this.mode){case"arc":e=this.toggleInhibitor(t);break;case"token":e=this.addArcToken(t,-1)}e&&this.update()}}]),t}(),M=function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).onClick=i.onClick.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"onClick",value:function(t){this.state.editorClick(t)}},{key:"componentDidMount",value:function(){var t,e=this;this.setState((t={onLoad:this.props.getPflow,onSave:this.props.setPflow,onUpdate:function(){e.setState(e.state)}},new A(t.onLoad,t.onSave,t.onUpdate)))}},{key:"render",value:function(){return this.state?a.a.createElement(a.a.Fragment,null,a.a.createElement(E,{ptnet:this.state}),a.a.createElement("svg",{width:window.innerWidth,height:window.innerHeight,onContextMenu:function(t){return t.preventDefault()},onClick:this.onClick},a.a.createElement("defs",null,a.a.createElement("marker",{id:"markerArrow1",markerWidth:"23",markerHeight:"13",refX:"31",refY:"6",orient:"auto"},a.a.createElement("rect",{className:"transition",width:"28",height:"3",fill:"#ffffff",stroke:"#ffffff",x:"3",y:"5"}),a.a.createElement("path",{d:"M2,2 L2,11 L10,6 L2,2"})),a.a.createElement("marker",{id:"markerInhibit1",markerWidth:"23",markerHeight:"13",refX:"31",refY:"6",orient:"auto"},a.a.createElement("rect",{className:"transition",width:"28",height:"3",fill:"#ffffff",stroke:"#ffffff",x:"3",y:"5"}),a.a.createElement("circle",{cx:"5",cy:"6.5",r:4}))),a.a.createElement(x,{ptnet:this.state}))):a.a.createElement(a.a.Fragment,null)}}]),e}(n.Component),_=(i(144),function(t){function e(t){var i;return Object(o.a)(this,e),(i=Object(c.a)(this,Object(u.a)(e).call(this,t))).getPflow=i.getPflow.bind(Object(h.a)(i)),i.setPflow=i.setPflow.bind(Object(h.a)(i)),i}return Object(p.a)(e,t),Object(l.a)(e,[{key:"getPflow",value:function(){return JSON.parse(JSON.stringify(this.state.ptnet))}},{key:"setPflow",value:function(t){this.setState({ptnet:t})}},{key:"open",value:function(t){var e=this;!function(t,e,i){var n=new XMLHttpRequest;n.open("GET","schemata/"+t+".pflow",!0),n.onload=function(a){4===n.readyState&&(200===n.status?Object(f.parseString)(n.responseText,(function(i,n){if(i)console.error(i);else{var a=new m(t,n);a.reindex(),e(new g(t,a))}})):(i(n.statusText),console.error(n.statusText)))},n.onerror=function(t){return console.error(n.statusText),null},n.send(null)}(t,(function(t){e.setPflow(t)}))}},{key:"componentDidMount",value:function(){this.open("counter")}},{key:"render",value:function(){return this.state?a.a.createElement("div",{className:"App"},a.a.createElement(M,{getPflow:this.getPflow,setPflow:this.setPflow})):a.a.createElement(a.a.Fragment,null)}}]),e}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},82:function(t,e,i){t.exports=i(145)},87:function(t,e,i){}},[[82,1,2]]]);
//# sourceMappingURL=main.280ca3fa.chunk.js.map